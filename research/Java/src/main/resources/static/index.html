<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Demo</title>
</head>
<body>

<script src="jquery-3.2.1.min.js"></script>
<script>

$(function() {

    // get the example content.
    $.get( "artifacts/getTemplate", function( data ) {
        $( "#artifact" ).html( data );
    });

    // deployment start
    $("#deploymentStartForm").submit(function(e) {
        //prevent Default functionality
        e.preventDefault();

        //get the action-url of the form
        var actionurl = e.currentTarget.action;

        $("#outputStart").html( 'Sending POST request to ' + actionurl + "\n" );

        $.ajax({
                url: actionurl,
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                data: $("#artifact").text(),
                success: function(data) {
                    var dataAsString = JSON.stringify(data);
                    var output = $("#outputStart").text() + "Success!\nResponse:\n" + dataAsString;
                    $("#outputStart").html( output );

                    // set the deployment key
                    $("#deploymentId").val(data.key);
                    $("#deploymentSpec").html(dataAsString);
                },
                error: function (xhr, textStatus, thrownError) {
                    var output = $("#outputStart").text() + "ERROR!\nResponse:\n" + textStatus + "\n" + thrownError;
                    $("#outputStart").html( output );

                }
        });
    });

    // deployment finish
    $("#deploymentFinishForm").submit(function(e) {

        //prevent Default functionality
        e.preventDefault();

        var deploymentId = $("#deploymentId").val();
        var successvalue = $("input[name='successvalue']:checked").val()

        //get the action-url of the form
        var actionurl = e.currentTarget.action + '/' + deploymentId + '/finish?success=' + successvalue ;

        $("#outputFinish").html( 'Sending POST request to ' + actionurl + "\n" );

        $.ajax({
                url: actionurl,
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                data: $("#artifact").text(),
                success: function(data) {
                    var dataAsString = JSON.stringify(data);
                    var output = $("#outputFinish").text() + "Success!\nResponse:\n" + dataAsString;
                    $("#outputFinish").html( output );


                },
                error: function (xhr, textStatus, thrownError) {
                    var output = $("#outputFinish").text() + "ERROR!\nResponse:\n" + textStatus + "\n" + thrownError;
                    $("#outputFinish").html( output );

                }
        });

    });

});



</script>
<h1>NRS CMDB Demo</h1>
<hr/>
<h2>Deployment Start </h2>
<form id="deploymentStartForm" method="post" action="deployments/start">
    <table border="0">
        <td>
            <h4>Artifact JSON:</h4>

            <textarea id="artifact" rows="20" cols="80" name="artifact"></textarea>
        </td>
        <td>
            <h4>Output:</h4>
            <textarea id="outputStart" rows="20" cols="80" name="outputStart"></textarea><br>

        </td>
    </table>
    <input type="submit" value="Start Deployment">

</form>


<hr/>

<h2>Deployment Finish</h2>

<form id="deploymentFinishForm" method="post" action="deployments">

            <h4>Deployment ID</h4>
            <input type="text" id="deploymentId" name="deploymentId" size="40">
            <h4>Was the deployment successful?</h4>
            <input type="radio" name="successvalue" value="True" checked>True <input type="radio" name="successvalue" value="False">False
    <table border="0">
        <td>
            <h4>Deployment Spec JSON:</h4>
            <textarea id="deploymentSpec" rows="20" cols="80" name="deploymentSpec"></textarea><br>
        </td>
        <td>
            <h4>Output:</h4>
            <textarea id="outputFinish" rows="20" cols="80" name="outputFinish"></textarea><br>

        </td>
    </table>
    <input type="submit" value="Finish Deployment">
</form>

<hr/>

<form id="reset" method="get" action="artifacts/resetTemplate" >
    <input type="submit" value="Reset Artifact Template">
</form>

</body>
</html>